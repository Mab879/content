documentation_complete: true

prodtype: alinux3,fedora,ol7,ol8,ol9,rhel7,rhel8,rhel9,sle12,sle15,ubuntu2004,ubuntu2204

title: 'Extend Audit Backlog Limit for the Audit Daemon'

description: |-
    To improve the kernel capacity to queue all log events, even those which occurred
    prior to the audit daemon, add the argument <tt>audit_backlog_limit=8192</tt> to the default
    GRUB 2 command line for the Linux operating system.
    {{{ describe_grub2_argument("audit_backlog_limit=8192") | indent(4) }}}

rationale: |-
    audit_backlog_limit sets the queue length for audit events awaiting transfer
    to the audit daemon. Until the audit daemon is up and running, all log messages
    are stored in this queue.  If the queue is overrun during boot process, the action
    defined by audit failure flag is taken.

severity: low

identifiers:
    cce@rhel7: CCE-82156-1
    cce@rhel8: CCE-80943-4
    cce@rhel9: CCE-83652-8

references:
    cis@alinux3: 4.1.1.4
    cis@rhel7: 4.1.2.4
    cis@rhel8: 4.1.1.4
    cis@sle12: 4.1.2.4
    cis@sle15: 4.1.2.4
    cis@ubuntu2004: 4.1.1.4
    cis@ubuntu2204: 4.1.1.4
    disa: CCI-000130,CCI-000135,CCI-000169,CCI-000172,CCI-001849,CCI-002884
    nist: CM-6(a)
    ospp: FAU_STG.1,FAU_STG.3
    srg: SRG-OS-000037-GPOS-00015,SRG-OS-000042-GPOS-00020,SRG-OS-000062-GPOS-00031,SRG-OS-000254-GPOS-00095,SRG-OS-000341-GPOS-00132,SRG-OS-000392-GPOS-00172,SRG-OS-000462-GPOS-00206,SRG-OS-000471-GPOS-00215
    stigid@ol8: OL08-00-030602
    stigid@rhel8: RHEL-08-030602

ocil_clause: 'audit backlog limit is not configured'

ocil: |-
    {{{ ocil_grub2_argument("audit_backlog_limit=8192") | indent(4) }}}

fixtext: |-
    Configure {{{ full_name }}} to allocate sufficient audit_backlog_limit to capture processes that start prior to the audit daemon with the following command:

    $ sudo grubby --update-kernel=ALL --args=audit_backlog_limit=8192

srg_requirement: '{{{ full_name }}} must allocate an audit_backlog_limit of sufficient size to capture processes that start prior to the audit daemon.'

platform: grub2

template:
    name: grub2_bootloader_argument
    vars:
        arg_name: audit_backlog_limit
        arg_value: '8192'

vuldiscussion: |-
    In order to ensure operating systems have a sufficient storage capacity in which to write the audit logs, operating systems need to be able to allocate audit record storage capacity.

    The task of allocating audit record storage capacity is usually performed during initial installation of the operating system.

checktext: |-
    Verify {{{ full_name }}} allocates a sufficient audit_backlog_limit to capture processes that start prior to the audit daemon with the following commands:

    First check if the GRUB recovery is enabled:

    $ sudo grep 'GRUB_DISABLE_RECOVERY' /etc/default/grub

    GRUB_DISABLE_RECOVERY="true"

    If this option is set to true, then check that a line is output by the following command:

    $ sudo grep 'GRUB_CMDLINE_LINUX_DEFAULT.*audit_backlog_limit=8192.*' /etc/default/grub

    If the option is set to false, then check that a line is output by the following command:

    $ sudo grep 'GRUB_CMDLINE_LINUX.*audit_backlog_limit=8192.*' /etc/default/grub

    If 'audit_backlog_limit' is not set to '8192' or greater, or the option is missing, this is a finding.

    Additionally command line parameters for currently installed kernels must be checked as well with the following command:

     $ sudo grubby --info=ALL | grep args | grep -v 'audit_backlog_limit=8192'

    If the command return any outputs and audit_backlog_limit is less than 8182, this is a finding.
