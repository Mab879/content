documentation_complete: true

prodtype: fedora,ol8,ol9,rhel8,rhel9

title: 'Enable the GNOME3 Screen Locking On Smartcard Removal'

description: |-
    In the default graphical environment, screen locking on smartcard removal
    can be enabled by setting <tt>removal-action</tt>
    to <tt>'lock-screen'</tt>.
    <br /><br />
    To enable, add or edit <tt>removal-action</tt> to
    <tt>/etc/dconf/db/local.d/00-security-settings</tt>. For example:
    <pre>[org/gnome/settings-daemon/peripherals/smartcard]
    removal-action='lock-screen'</pre>
    Once the setting has been added, add a lock to
    <tt>/etc/dconf/db/local.d/locks/00-security-settings-lock</tt> to prevent user modification.
    For example:
    <pre>/org/gnome/settings-daemon/peripherals/smartcard/removal-action</pre>
    After the settings have been set, run <tt>dconf update</tt>.

rationale: |-
    Locking the screen automatically when removing the smartcard can
    prevent undesired access to system.

severity: medium

identifiers:
    cce@rhel8: CCE-83910-0
    cce@rhel9: CCE-86452-0

references:
    disa: CCI-000056,CCI-000058
    srg: SRG-OS-000028-GPOS-00009,SRG-OS-000030-GPOS-00011
    stigid@ol8: OL08-00-020050
    stigid@rhel8: RHEL-08-020050

ocil_clause: 'removal-action has not been configured'

ocil: |-
    To ensure screen locking on smartcard removal is enabled, run the following command:
    <pre>$ grep removal-action /etc/dconf/db/local.d/*</pre>
    The output should be <tt>'lock-screen'</tt>.
    To ensure that users cannot disable screen locking on smartcard removal, run the following:
    <pre>$ grep removal-action /etc/dconf/db/local.d/locks/*</pre>
    If properly configured, the output should be <tt>/org/gnome/settings-daemon/peripherals/smartcard/removal-action</tt>

fixtext: |-
    Add the following line to "/etc/dconf/db/local.d/locks/00-security-settings-lock" to prevent user override of the smartcard removal action:

    /org/gnome/settings-daemon/peripherals/smartcard/removal-action

    Then update the dconf system databases:

    $ sudo dconf update

srg_requirement: |-
    {{{ full_name }}} must prevent a user from overriding the disabling of the graphical user martcard removal action.

platform: machine

template:
    name: dconf_ini_file
    vars:
        parameter: removal-action
        value: "'lock-screen'"
        section: "org/gnome/settings-daemon/peripherals/smartcard"
        path: /etc/dconf/db/local.d/

checktext: |-
    Verify {{{ full_name }}} disables ability of the user to override the smartcard removal action setting.

    Determine which profile the system database is using with the following command:

    $ sudo grep system-db /etc/dconf/profile/user

    system-db:local

    Check that the removal action setting is locked from non-privileged user modification with the following command:

    Note: The example below is using the database "local" for the system, so the path is "/etc/dconf/db/local.d". This path must be modified if a database other than "local" is being used.

    $ grep 'removal-action' /etc/dconf/db/local.d/locks/*

    /org/gnome/settings-daemon/peripherals/smartcard/removal-action

    If the command does not return at least the example result, this is a finding.
